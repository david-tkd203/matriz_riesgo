<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Matriz de Riesgo</title>

    <link rel="stylesheet" href="style.css" />

    <!-- Librería XLSX -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" defer></script>

    <!-- Vista en tabla (tu script) -->
    <script src="js/script.js" defer></script>

    <!-- Vista de tarjetas D→R (aislada para no chocar con script.js) -->
    <script src="js/vista_previa.js" defer></script>

    <!-- Descarga de imágenes (tarjeta / informe) -->
    <script src="js/descargar_imagenes.js" defer></script>

    <!-- Navbar / mega-menú -->
    <script src="js/menu.js" defer></script>
</head>
<body>

    <!-- ======= BARRA DE MARCA (logos) ======= -->
    <header class="brandbar" role="banner">
        <div class="brandbar__inner container">
        <div class="brandbar__left">
            <img src="static/img/logo_cencosud.png" alt="Cencosud" class="brand-logo brand-logo--cenco" />
        </div>

        <div class="brandbar__title">
            <h1>Matriz de Riesgo</h1>
            <p class="brandbar__subtitle">Visualización y revalorización de riesgos</p>
        </div>

        <div class="brandbar__right">
            <img src="static/img/logo_ist.png" alt="IST" class="brand-logo brand-logo--ist" />
        </div>
        </div>
    </header>

    <!-- ============== NAVBAR / ÍNDICE ============== -->
    <nav class="subnav" role="navigation" aria-label="Índice">
        <div class="container subnav__inner">
        <ul class="subnav__list">
            <li class="subnav__item">
            <a class="subnav__link" href="#matriz">Matriz de Riesgo</a>
            </li>

            <!-- Ítem DS44 con link + botón de despliegue -->
            <li class="subnav__item subnav__item--hasmenu">
            <!-- Link directo a ds44.html -->
            <a href="./ds44.html">Decreto Supremo N°44</a>

            <!-- Botón para abrir/cerrar el mega menú -->
            <button class="subnav__toggle" type="button"
                    aria-haspopup="true" aria-expanded="false" aria-controls="menu-ds44"
                    title="Abrir menú DS44">
                <svg class="subnav__chev" width="12" height="12" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M7 10l5 5 5-5" fill="none" stroke="currentColor" stroke-width="2"/>
                </svg>
            </button>

            <!-- Mega menú -->
            <div id="menu-ds44" class="mega" hidden>
                <div class="mega__scroll">
                <!-- Árbol colapsable con <details> para accesibilidad -->
                <details class="tree" open>
                    <summary>1.1 Política SST</summary>
                    <ul>
                    <li><a href="#">1.1.1 Modelo</a></li>
                    <li><a href="#">1.1.2. Política SST</a></li>
                    <li><a href="#">1.1.3 Registros de gestión</a></li>
                    </ul>
                </details>

                <details class="tree">
                    <summary>1.2 Organización de SST</summary>
                    <ul>
                    <li><a href="#">1.2.1 Modelo</a></li>
                    <li><a href="#">1.2.2 Organización de SST</a></li>
                    <li><a href="#">1.2.3 Registros de gestión</a></li>
                    </ul>
                </details>

                <details class="tree">
                    <summary>1.3 Autoevaluación SST</summary>
                    <ul>
                    <li><a href="#">1.3.1 Modelo</a></li>
                    <li><a href="#">1.3.2 Evaluación legal SST</a></li>
                    <li><a href="#">1.3.3 Registros de gestión</a></li>
                    </ul>
                </details>

                <details class="tree">
                    <summary>1.4 Matriz IPER</summary>
                    <ul>
                    <li><a href="#">1.4.1 Modelo</a></li>
                    <li><a href="#">1.4.2 Diagnóstico inicial SST</a></li>
                    <li><a href="#">1.4.3 Registros de gestión</a></li>
                    </ul>
                </details>

                <details class="tree">
                    <summary>1.5 Programa de Trabajo SST</summary>
                    <ul>
                    <li><a href="#">1.5.1 Modelo</a></li>
                    <li><a href="#">1.5.2 Programa de Trabajo SST</a></li>
                    <li><a href="#">1.5.3 Registros de gestión</a></li>
                    </ul>
                </details>

                <details class="tree">
                    <summary>1.6 Investigación Incidentes y EP</summary>
                    <ul>
                    <li><a href="#">1.6.1 Modelo</a></li>
                    <li><a href="#">1.6.2 Investigación incidentes, accidentes y EP</a></li>
                    <li><a href="#">1.6.3 Registros de gestión</a></li>
                    </ul>
                </details>

                <details class="tree">
                    <summary>1.7 Gestión de EPP</summary>
                    <ul>
                    <li><a href="#">1.7.1 Modelo</a></li>
                    <li><a href="#">1.7.2 Gestión de EPP</a></li>
                    <li><a href="#">1.7.3 Registros de gestión</a></li>
                    </ul>
                </details>

                <details class="tree">
                    <summary>1.8 Capacitación e información</summary>
                    <ul>
                    <li><a href="#">1.8.1 Modelo</a></li>
                    <li><a href="#">1.8.2 Información, formación, consulta, comunicación</a></li>
                    <li><a href="#">1.8.3 Registros de gestión</a></li>
                    </ul>
                </details>

                <details class="tree">
                    <summary>1.9 Gestión de riesgos y desastres</summary>
                    <ul>
                    <li><a href="#">1.9.1 Modelo</a></li>
                    <li><a href="#">1.9.2 PGRD</a></li>
                    <li><a href="#">1.9.3 Registros de gestión</a></li>
                    </ul>
                </details>

                <details class="tree">
                    <summary>1.10 Gestión de CPHS</summary>
                    <ul>
                    <li><a href="#">1.10.1 Modelo</a></li>
                    <li><a href="#">1.10.2 Gestión de CPHS</a></li>
                    <li><a href="#">1.10.3 Registros de gestión</a></li>
                    </ul>
                </details>

                <details class="tree">
                    <summary>1.11 Indicadores de gestión</summary>
                    <ul>
                    <li><a href="#">1.11.1 Modelo</a></li>
                    <li>
                        <details>
                        <summary>1.11.2 Gestión de indicadores SST</summary>
                        <ul>
                            <li><a href="#">Carpeta sin título</a></li>
                        </ul>
                        </details>
                    </li>
                    <li><a href="#">1.11.3 Registros de gestión</a></li>
                    </ul>
                </details>

                <details class="tree">
                    <summary>1.12 Reglamento interno</summary>
                    <ul>
                    <li><a href="#">1.12.1 Modelo</a></li>
                    <li><a href="#">1.12.2 Reglamento</a></li>
                    <li><a href="#">1.12.3 Registros de gestión</a></li>
                    </ul>
                </details>

                <details class="tree">
                    <summary>1.13 Mapa de riesgos</summary>
                    <ul>
                    <li>
                        <details open>
                        <summary>1.13.1 Modelo</summary>
                        <ul>
                            <li><a href="#">Simbología mapas de riesgos 2025</a>
                            <ul class="tree__leaves">
                                <li><a href="#">Músculo esquelético</a></li>
                                <li><a href="#">Psicosocial</a></li>
                                <li><a href="#">Riesgos Higiénicos</a>
                                <ul>
                                    <li><a href="#">Amarillos</a></li>
                                    <li><a href="#">Naranjo</a></li>
                                    <li><a href="#">Rojo</a></li>
                                    <li><a href="#">Verde</a></li>
                                </ul>
                                </li>
                                <li><a href="#">Riesgos Seguridad</a>
                                <ul>
                                    <li><a href="#">Amarillo</a></li>
                                    <li><a href="#">Naranjo</a></li>
                                    <li><a href="#">Rojo</a></li>
                                    <li><a href="#">Verde</a></li>
                                </ul>
                                </li>
                            </ul>
                            </li>
                        </ul>
                        </details>
                    </li>
                    <li><a href="#">1.13.2 Mapa de riesgos</a></li>
                    <li><a href="#">1.13.3 Registros de gestión</a></li>
                    </ul>
                </details>

                <details class="tree">
                    <summary>1.14 Delegado</summary>
                    <ul>
                    <li><a href="#">1.14.1 Modelo</a></li>
                    <li><a href="#">1.14.2 Delegado</a></li>
                    <li><a href="#">1.14.3 Registros</a></li>
                    </ul>
                </details>

                <details class="tree">
                    <summary>1.15 Encargado</summary>
                    <ul>
                    <li><a href="#">1.15.1 Modelo</a></li>
                    <li><a href="#">1.15.2 Encargado</a></li>
                    <li><a href="#">1.15.3 Registro</a></li>
                    </ul>
                </details>

                <details class="tree">
                    <summary>1.16 Seguimiento y mejoramiento</summary>
                    <ul>
                    <li><a href="#">1.16.1 Modelo</a></li>
                    <li><a href="#">1.16.2 Seguimiento y mejoramiento SST</a></li>
                    <li><a href="#">1.16.3 Registros de gestión</a></li>
                    </ul>
                </details>
                </div>
            </div>
            </li>
        </ul>
        </div>
    </nav>

    <main class="container" id="matriz">
        <section class="panel">
        <div class="filters">
            <label class="field" for="vp-filter-input">
            <span>Buscar hoja</span>
            <input id="vp-filter-input" type="text" placeholder="Escribe parte del nombre…" autocomplete="off" />
            </label>
        </div>
        <div id="vp-status" class="status" aria-live="polite">Cargando…</div>
        </section>

        <section class="panel">
        <h3 class="panel-title">Áreas Disponibles</h3>
        <div id="vp-sheets" class="sheets" aria-live="polite"></div>
        </section>

        <section class="panel">
        <h3 class="panel-title">Filtros</h3>
        <div class="filters">
            <label class="field" for="vp-process-filter">
            <span>Procesos (B)</span>
            <select id="vp-process-filter" disabled>
                <option value="__ALL__">— Todas —</option>
            </select>
            </label>

            <label class="field" for="vp-activity-filter">
            <span>Actividad / Infraestructura (C)</span>
            <select id="vp-activity-filter" disabled>
                <option value="__ALL__">— Todas —</option>
            </select>
            </label>

            <!-- Filtro de Riesgos -->
            <label class="field" for="vp-risk-filter">
            <span>Riesgos</span>
            <select id="vp-risk-filter" disabled>
                <option value="__ALL__">— Todos —</option>
            </select>
            </label>

            <button id="vp-clear" class="btn" type="button" disabled>Limpiar filtros</button>
        </div>
        </section>

        <section class="panel">
        <h3 class="panel-title">Resultados de Riesgos</h3>
        <div id="vp-cards" class="cards"></div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
        <small>Funciona con SheetJS · Tabla + Tarjetas · Lectura por A1 (encabezados fila 10/11, datos desde fila 12).</small>
        </div>
    </footer>

</body>
</html>
